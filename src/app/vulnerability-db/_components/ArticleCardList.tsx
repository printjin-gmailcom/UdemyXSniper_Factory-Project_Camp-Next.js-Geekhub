'use client';

import SuggestionChip from '@/components/Chips/SuggestionChip';
import ArticleCard from '@/components/VulDbCard/ArticleCard';
import { ArticleData } from '@/types/crawlingData';
import { useSession } from 'next-auth/react';
import Link from 'next/link';
import { useState } from 'react';

const companyList: string[] = ['마이크로소프트', '오라클', 'GitLab', '아파치', '리눅스'];

type CompanyConfig = {
  마이크로소프트: string;
  오라클: string;
  GitLab: string;
  아파치: string;
  리눅스: string;
};

const companyConfig: CompanyConfig = {
  마이크로소프트: 'microsoft',
  오라클: 'Oracle',
  GitLab: 'GitLab',
  아파치: 'Apache',
  리눅스: 'Linux',
};

export default function ArticleCardList({ dataList }: { dataList: ArticleData[] }) {
  const [toggleLabel, setToggleLabel] = useState(true);
  const session = useSession();
  const userId = session.data?.user.id;

  const checkCompany = (title: string): string => {
    let companyName = 'other';
    companyList.forEach(company => {
      if (title.indexOf(company) === -1) {
        return false;
      } else {
        companyName = companyConfig[company as keyof CompanyConfig];
        return true;
      }
    });
    return companyName;
  };

  const onClickLabel = () => {
    setToggleLabel(prev => !prev);
  };

  if (!userId) {
    return (
      <div className="flex h-[141.4rem] w-[86.5rem] flex-col gap-[1.6rem] bg-[url(/images/blurDb.png)]">
        <div className="m-[4.3rem_auto_0] flex w-fit flex-col items-center gap-[3.2rem] rounded-[2rem] bg-white px-[6rem] py-[4rem] shadow-drop">
          <span className="text-[2rem]">자세한 정보를 보고싶다면?</span>
          <Link href="/login">
            <h2 className="w-fit cursor-pointer rounded-full border-[0.2rem] border-primary-500 bg-white px-[4rem] py-[2rem] text-[2.4rem] font-regular text-primary-500">
              Login
            </h2>
          </Link>
        </div>
      </div>
    );
  }

  return (
    <div className="flex flex-col gap-[1.6rem]">
      <h2 className="text-[2.4rem] font-bold leading-[2.905rem]">취약점 DB</h2>
      <div className="flex gap-[1.2rem]">
        <Link href="/vulnerability-db?label=hot&page=1" scroll={false}>
          <button type="button" onClick={onClickLabel}>
            <SuggestionChip variant="hot" isActive={toggleLabel} />
          </button>
        </Link>
        <Link href="/vulnerability-db?label=new&page=1" scroll={false}>
          <button type="button" onClick={onClickLabel}>
            <SuggestionChip variant="new" isActive={!toggleLabel} />
          </button>
        </Link>
      </div>
      <div className="flex flex-col gap-[1.6rem]">
        {dataList.map(data => {
          return (
            <Link key={data.id} href={`/vulnerability-db/${data.id}`}>
              <ArticleCard
                company={checkCompany(data.title)}
                date={data.scrapDate}
                label=""
                id={data.id}
                title={data.title}
                content={typeof data.content[0] === 'string' ? data.content[0] : 'table 데이터....'}
                isScrapped={data.isScrapped}
              />
            </Link>
          );
        })}
      </div>
    </div>
  );
}
