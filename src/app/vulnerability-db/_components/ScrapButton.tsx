'use client';

import { BigPinIcon, FillPinIcon } from '@/public/index';
import { useSession } from 'next-auth/react';
import { useState } from 'react';
import { toast } from 'react-toastify';

type ScrapButtonProps = {
  isScrapped: boolean;
  articleId: string;
};

export default function ScrapButton({ isScrapped, articleId }: ScrapButtonProps) {
  const [scrapped, setScrapped] = useState(isScrapped);

  const { data: session } = useSession();
  const userId = session?.user?.id;

  const addScrap = async () => {
    const response = await fetch('/api/scrap', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ userId, articleId }),
    });

    const data = await response.json();
    if (response.ok) {
      setScrapped(true);
      toast.success(data.message);
    } else {
      toast.error(data.error);
    }

    console.log(scrapped);
  };

  const removeScrap = async () => {
    const response = await fetch('/api/scrap', {
      method: 'DELETE',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ userId, articleId }),
    });

    const data = await response.json();

    if (response.ok) {
      setScrapped(false);
      toast.success(data.message);
    } else {
      toast.error(data.error);
    }
  };

  return (
    <button type="button" onClick={scrapped ? removeScrap : addScrap}>
      {isScrapped ? <FillPinIcon /> : <BigPinIcon />}
    </button>
  );
}
