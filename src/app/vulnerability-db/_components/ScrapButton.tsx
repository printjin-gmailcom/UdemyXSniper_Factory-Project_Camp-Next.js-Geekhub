'use client';

import { FillPinIcon, OutlinePinIcon } from '@/public/index';
import { useSession } from 'next-auth/react';
import { MouseEvent, useState } from 'react';
import { toast } from 'react-toastify';

type ScrapButtonProps = {
  isScrapped: boolean;
  articleId: string;
  title: string;
};

export default function ScrapButton({ isScrapped, articleId, title }: ScrapButtonProps) {
  const [scrapped, setScrapped] = useState(isScrapped);
  const { data: session } = useSession();
  const userId = session?.user?.id;

  const toggleScrap = async (e: MouseEvent<HTMLButtonElement>) => {
    e.preventDefault();
    e.stopPropagation();
    const method = scrapped ? 'DELETE' : 'POST';
    const response = await fetch('/api/scrap', {
      method,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ userId, articleId, title }),
    });

    const data = await response.json();
    if (response.ok) {
      setScrapped(!scrapped);
      toast.success(data.message);
    } else {
      toast.error(data.error);
    }
  };

  return (
    <button type="button" onClick={toggleScrap}>
      {scrapped ? <FillPinIcon /> : <OutlinePinIcon />}
    </button>
  );
}
