'use client';

import { Modal } from '@/components/Modals';
import useKakaoShare from '@/hooks/useKakaoShare';
import { useModal } from '@/hooks/useModal';
import { KakaoIcon, LinkIcon, ShareIcon } from '@/public/index';
import { MouseEvent, useEffect, useState } from 'react';
import { toast } from 'react-toastify';

export default function ShareButton({ title }: { title: string }) {
  const [isModalOpen, handleClickTrigger] = useModal();
  const [shareUrl, setShareUrl] = useState('');
  const { shareKakao } = useKakaoShare(shareUrl);

  useEffect(() => {
    if (typeof window !== 'undefined') {
      setShareUrl(window.location.href);
    }
  }, []);

  const handleKakaoIconClick = (e: MouseEvent<HTMLButtonElement>) => {
    e.stopPropagation();
    shareKakao(title);
    handleClickTrigger();
  };

  const handleLinkIconClick = async (e: MouseEvent<HTMLButtonElement>) => {
    e.stopPropagation();
    try {
      await navigator.clipboard.writeText(shareUrl);
      toast.success('링크가 클립보드에 복사되었습니다.');
    } catch (err) {
      toast.error('오류가 발생했습니다. 다시 시도해 주세요.');
    }
    handleClickTrigger();
  };

  const handleClickShare = (e: MouseEvent<HTMLButtonElement>) => {
    e.stopPropagation();
    e.preventDefault();
    handleClickTrigger();
  };

  return (
    <>
      <button type="button" onClick={handleClickShare}>
        <ShareIcon />
      </button>
      <Modal
        gap={24}
        padding={40}
        hasDimmed
        setIsModalOpen={handleClickTrigger}
        isOpen={isModalOpen}
      >
        <Modal.Title size="lg">뉴스 공유하기</Modal.Title>
        <div className="flex gap-[2rem]">
          <button
            type="button"
            className="flex h-[4.9rem] w-[4.9rem] items-center justify-center rounded-full bg-[#ffe300]"
            onClick={handleKakaoIconClick}
          >
            <KakaoIcon />
          </button>
          <button
            type="button"
            className="flex h-[4.9rem] items-center justify-center gap-[0.4rem] rounded-full bg-primary-50 px-[1.6rem] text-[1.5rem] text-gray-black"
            onClick={handleLinkIconClick}
          >
            <LinkIcon /> 링크 복사하기
          </button>
        </div>
      </Modal>
    </>
  );
}
